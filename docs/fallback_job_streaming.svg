<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="843px" preserveAspectRatio="none" style="width:759px;height:843px;" version="1.1" viewBox="0 0 759 843" width="759px" zoomAndPan="magnify"><defs><filter height="300%" id="f2gs2dgoahb4s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#ADD8E6" height="828.2562" style="stroke: #A80036; stroke-width: 1.0;" width="350" x="381" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="494" y="17.897">Pod (Job Container)</text><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="570.7083" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="414.5" y="154.4799"/><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="350.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="671.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676.5" y="591.3642"/><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="724" x="13" y="547.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="45" x2="45" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="204" x2="204" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="419" x2="419" y1="89.0679" y2="743.1882"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="676" x2="676" y1="89.0679" y2="743.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="84.9659">Client</text><ellipse cx="45.5" cy="13" fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,21 L45.5,48 M32.5,29 L58.5,29 M45.5,48 L32.5,63 M45.5,48 L58.5,63 " fill="none" filter="url(#f2gs2dgoahb4s)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="23" y="757.1542">Client</text><ellipse cx="45.5" cy="771.2562" fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M45.5,779.2562 L45.5,806.2562 M32.5,787.2562 L58.5,787.2562 M45.5,806.2562 L32.5,821.2562 M45.5,806.2562 L58.5,821.2562 " fill="none" filter="url(#f2gs2dgoahb4s)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="72.9659">Fallback Client</text><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="147" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="154" y="764.1542">Fallback Client</text><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="385" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="392" y="72.9659">Process</text><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="385" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="392" y="764.1542">Process</text><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="626" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="633" y="72.9659">Proxy Server</text><rect fill="#FEFECE" filter="url(#f2gs2dgoahb4s)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="626" y="742.1882"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="633" y="764.1542">Proxy Server</text><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="570.7083" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="414.5" y="154.4799"/><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="350.7662" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="671.5" y="374.4221"/><rect fill="#FFFFFF" filter="url(#f2gs2dgoahb4s)" height="95.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676.5" y="591.3642"/><polygon fill="#A80036" points="192.5,118.7739,202.5,122.7739,192.5,126.7739,196.5,122.7739" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="198.5" y1="122.7739" y2="122.7739"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="52.5" y="116.9649">Request streaming job</text><polygon fill="#A80036" points="402.5,150.4799,412.5,154.4799,402.5,158.4799,406.5,154.4799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="408.5" y1="154.4799" y2="154.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="211.5" y="148.6709">Request process creation</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="424.5" x2="466.5" y1="203.892" y2="203.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="466.5" x2="466.5" y1="203.892" y2="216.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="425.5" x2="466.5" y1="216.892" y2="216.892"/><polygon fill="#A80036" points="435.5,212.892,425.5,216.892,435.5,220.892,431.5,216.892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="431.5" y="180.377">Start job container</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="431.5" y="198.083">Install NGINX</text><polygon fill="#A80036" points="215.5,244.598,205.5,248.598,215.5,252.598,211.5,248.598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="413.5" y1="248.598" y2="248.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="221.5" y="242.789">Container is ready</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="246.5" y1="280.304" y2="280.304"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246.5" x2="246.5" y1="280.304" y2="293.304"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="205.5" x2="246.5" y1="293.304" y2="293.304"/><polygon fill="#A80036" points="215.5,289.304,205.5,293.304,215.5,297.304,211.5,293.304" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="211.5" y="274.495">Generate client certificate</text><polygon fill="#A80036" points="402.5,321.01,412.5,325.01,402.5,329.01,406.5,325.01" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="408.5" y1="325.01" y2="325.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="211.5" y="319.201">Upload client certificate (rsync)</text><polygon fill="#A80036" points="659.5,370.4221,669.5,374.4221,659.5,378.4221,663.5,374.4221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424.5" x2="665.5" y1="374.4221" y2="374.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="431.5" y="350.907">Generate server certificate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="431.5" y="368.6131">Start proxy server (requires client cert)</text><polygon fill="#A80036" points="402.5,402.1281,412.5,406.1281,402.5,410.1281,406.5,406.1281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204.5" x2="408.5" y1="406.1281" y2="406.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="211.5" y="400.3191">Poll for server certificate (rsync)</text><polygon fill="#A80036" points="215.5,433.8341,205.5,437.8341,215.5,441.8341,211.5,437.8341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209.5" x2="413.5" y1="437.8341" y2="437.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="221.5" y="432.0251">Return server public certificate</text><polygon fill="#A80036" points="56.5,483.2461,46.5,487.2461,56.5,491.2461,52.5,487.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="203.5" y1="487.2461" y2="487.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="62.5" y="463.7311">Return server address</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="62.5" y="481.4371">and public certificate</text><rect fill="#EEEEEE" filter="url(#f2gs2dgoahb4s)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="744" x="3" y="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="747" y1="517.0991" y2="517.0991"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="747" y1="520.0991" y2="520.0991"/><rect fill="#EEEEEE" filter="url(#f2gs2dgoahb4s)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="128" x="311" y="505.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="317" y="523.1431">Streaming Phase</text><path d="M13,547.9521 L86,547.9521 L86,556.9521 L76,566.9521 L13,566.9521 L13,547.9521 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.5301" style="stroke: #000000; stroke-width: 2.0;" width="724" x="13" y="547.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="28" y="562.8492">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263" x="101" y="561.7111">[Streaming until client finishes or job times out]</text><polygon fill="#A80036" points="664.5,587.3642,674.5,591.3642,664.5,595.3642,668.5,591.3642" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="45.5" x2="670.5" y1="591.3642" y2="591.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="52.5" y="585.5552">Request (signed with client cert)</text><polygon fill="#A80036" points="435.5,619.0702,425.5,623.0702,435.5,627.0702,431.5,623.0702" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429.5" x2="675.5" y1="623.0702" y2="623.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="441.5" y="617.2612">Forward to unsafe HTTP app</text><polygon fill="#A80036" points="664.5,650.7762,674.5,654.7762,664.5,658.7762,668.5,654.7762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424.5" x2="670.5" y1="654.7762" y2="654.7762"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="431.5" y="648.9672">Response from app</text><polygon fill="#A80036" points="56.5,682.4822,46.5,686.4822,56.5,690.4822,52.5,686.4822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="670.5" y1="686.4822" y2="686.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="62.5" y="680.6732">Response (signed with server cert)</text><polygon fill="#A80036" points="56.5,721.1882,46.5,725.1882,56.5,729.1882,52.5,725.1882" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="50.5" x2="418.5" y1="725.1882" y2="725.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="62.5" y="719.3792">Job finished</text><!--MD5=[c54d3a0d0e2f74ff48ba92c72047bb08]
@startuml
actor Client
participant "Fallback Client"
box "Pod (Job Container)" #LightBlue
  participant Process
  participant "Proxy Server"
end box

Client -> "Fallback Client": Request streaming job

"Fallback Client" -> Process: Request process creation
activate Process
Process -> Process: Start job container\nInstall NGINX
Process -> "Fallback Client": Container is ready

"Fallback Client" -> "Fallback Client": Generate client certificate
"Fallback Client" -> Process: Upload client certificate (rsync)

Process -> "Proxy Server": Generate server certificate\nStart proxy server (requires client cert)
activate "Proxy Server"
"Fallback Client" -> Process: Poll for server certificate (rsync)
Process -> "Fallback Client": Return server public certificate

"Fallback Client" -> Client: Return server address\nand public certificate

== Streaming Phase ==
loop Streaming until client finishes or job times out
  Client -> "Proxy Server": Request (signed with client cert)
  activate "Proxy Server"
  "Proxy Server" -> Process: Forward to unsafe HTTP app
  Process - -> "Proxy Server": Response from app
  "Proxy Server" -> Client: Response (signed with server cert)
  deactivate "Proxy Server"
end

Process -> Client: Job finished
deactivate "Proxy Server"
deactivate Process

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Ubuntu-0ubuntu124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>