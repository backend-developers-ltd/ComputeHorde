<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4068px" preserveAspectRatio="none" style="width:1767px;height:4068px;" version="1.1" viewBox="0 0 1767 4068" width="1767px" zoomAndPan="magnify"><defs><filter height="300%" id="f11ucvj12t3os4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFBB" height="4053.8674" style="stroke: #808080; stroke-width: 1.0;" width="92" x="165" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="175.5" y="17.897">Facilitator</text><rect fill="#EEF5FF" height="4053.8674" style="stroke: #808080; stroke-width: 1.0;" width="263.5" x="296" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="396.25" y="17.897">Validator</text><rect fill="#FFFFE0" height="4053.8674" style="stroke: #808080; stroke-width: 1.0;" width="342" x="617.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="767.5" y="17.897">Miner</text><rect fill="#EFEFEF" height="4053.8674" style="stroke: #808080; stroke-width: 1.0;" width="507.5" x="1021" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="1243.75" y="17.897">Executor</text><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="300.1788" style="stroke: #000000; stroke-width: 2.0;" width="702" x="195" y="707.9597"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="2925.661" style="stroke: #000000; stroke-width: 2.0;" width="1740" x="6" y="1021.1385"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="895.7515" style="stroke: #000000; stroke-width: 2.0;" width="1305" x="195" y="1403.4637"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="811.2067" style="stroke: #000000; stroke-width: 2.0;" width="977" x="498" y="1432.1697"/><rect fill="#FFFFFF" height="572.8378" style="stroke: none; stroke-width: 1.0;" width="977" x="498" y="1670.5386"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="188.2361" style="stroke: #000000; stroke-width: 2.0;" width="335" x="1047" y="2017.0075"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="1360.6346" style="stroke: #000000; stroke-width: 2.0;" width="1696" x="25" y="2440.4872"/><rect fill="#FFFFFF" height="1224.8105" style="stroke: none; stroke-width: 1.0;" width="1696" x="25" y="2576.3113"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="88.118" style="stroke: #000000; stroke-width: 2.0;" width="1496.5" x="44" y="2469.1932"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="386.1782" style="stroke: #000000; stroke-width: 2.0;" width="1501" x="195" y="2704.1172"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="182.2361" style="stroke: #000000; stroke-width: 2.0;" width="1379" x="195" y="3156.7075"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="386.7662" style="stroke: #000000; stroke-width: 2.0;" width="1109" x="456.5" y="3405.3556"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="101.118" style="stroke: #000000; stroke-width: 2.0;" width="493.5" x="1047" y="3478.7676"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="60" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="60" x2="60" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="60" y1="204.4799" y2="3965.7994"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="211" x2="211" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="211" x2="211" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="211" x2="211" y1="204.4799" y2="3965.7994"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="33" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="206" y="143.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="143.4799" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="216" x2="216" y1="143.4799" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="216" y1="143.4799" y2="143.4799"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="3761.3195" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="206" y="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="206" y1="204.4799" y2="3965.7994"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="216" x2="216" y1="204.4799" y2="3965.7994"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="206" x2="216" y1="3965.7994" y2="3965.7994"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="381" x2="381" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="381" x2="381" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="381" x2="381" y1="204.4799" y2="3965.7994"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="3602.0686" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="376" y="319.7308"/><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="3418.9789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="381" y="455.9817"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514" x2="514" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="514" x2="514" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="514" x2="514" y1="204.4799" y2="3965.7994"/><rect fill="#FF9999" filter="url(#f11ucvj12t3os4)" height="3245.8609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="585.3937"/><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="267.4728" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514" y="732.6657"/><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="1245.3707" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514" y="1045.8445"/><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="1145.4166" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="514" y="2646.7052"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="697" x2="697" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="697" x2="697" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="697" x2="697" y1="204.4799" y2="3965.7994"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="3147.316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="692" y="644.8057"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="881" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="881" x2="881" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881" x2="881" y1="204.4799" y2="3965.7994"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="1950.3652" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="876" y="1841.7566"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="1063" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1063" x2="1063" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="1063" y1="204.4799" y2="3965.7994"/><rect fill="#FF9999" filter="url(#f11ucvj12t3os4)" height="2566.0418" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058" y="1355.7577"/><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="163.9569" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1063" y="1456.8757"/><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="547.8559" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1063" y="1687.5205"/><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="1131.1374" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1063" y="2700.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1459" x2="1459" y1="111.7739" y2="176.4799"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1459" x2="1459" y1="176.4799" y2="204.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1459" x2="1459" y1="204.4799" y2="3965.7994"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="101.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1454" y="2465.1932"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="177.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1454" y="2855.3533"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1454" y="3720.7098"/><rect fill="#006400" filter="url(#f11ucvj12t3os4)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1459" y="2517.6053"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="31.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1459" y="3689.0037"/><rect fill="#FFFFFF" filter="url(#f11ucvj12t3os4)" height="76.412" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1464" y="3612.5917"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="37.5" y="107.672">Client</text><ellipse cx="60" cy="35.706" fill="#FEFECE" filter="url(#f11ucvj12t3os4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M60,43.706 L60,70.706 M47,51.706 L73,51.706 M60,70.706 L47,85.706 M60,70.706 L73,85.706 " fill="none" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="169" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="176" y="95.672">Facilitator</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="300" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="307" y="95.672">Facilitator connection</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="472.5" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="479.5" y="95.672">Job driver</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="621.5" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="628.5" y="95.672">Validator Consumer</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="806.5" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="813.5" y="95.672">Executor Consumer</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="1025" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1032" y="95.672">Executor</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1393.5" y="73.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1400.5" y="95.672">Task/Subprocess</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="37.5" y="4047.7654">Client</text><ellipse cx="60" cy="3975.7994" fill="#FEFECE" filter="url(#f11ucvj12t3os4)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M60,3983.7994 L60,4010.7994 M47,3991.7994 L73,3991.7994 M60,4010.7994 L47,4025.7994 M60,4010.7994 L73,4025.7994 " fill="none" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="169" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="176" y="3987.7654">Facilitator</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="300" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="307" y="3987.7654">Facilitator connection</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="472.5" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="479.5" y="3987.7654">Job driver</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="147" x="621.5" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="628.5" y="3987.7654">Validator Consumer</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="806.5" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="813.5" y="3987.7654">Executor Consumer</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="1025" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="1032" y="3987.7654">Executor</text><rect fill="#FEFECE" filter="url(#f11ucvj12t3os4)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1393.5" y="3965.7994"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1400.5" y="3987.7654">Task/Subprocess</text><polygon fill="#A80036" points="227,139.4799,217,143.4799,227,147.4799,223,143.4799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="380" y1="143.4799" y2="143.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="233" y="137.6709">Connect</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="102" y1="228.186" y2="228.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="102" y1="228.186" y2="241.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="102" y1="241.186" y2="241.186"/><polygon fill="#A80036" points="71,237.186,61,241.186,71,245.186,67,241.186" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="67" y="222.377">Generate client keypair</text><polygon fill="#A80036" points="194,286.598,204,290.598,194,294.598,198,290.598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="200" y1="290.598" y2="290.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="67" y="267.083">Create job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="67" y="284.789">(HTTP)</text><polygon fill="#A80036" points="364,315.7308,374,319.7308,364,323.7308,368,319.7308" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="216" x2="370" y1="319.7308" y2="319.7308"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="223" y="314.6649">V2JobRequest</text><polygon fill="#A80036" points="227,362.5696,217,366.5696,227,370.5696,223,366.5696" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="375" y1="366.5696" y2="366.5696"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="233" y="343.7977">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="233" y="360.7606">(Received)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="386" x2="428" y1="398.2757" y2="398.2757"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="428" y1="398.2757" y2="411.2757"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="387" x2="428" y1="411.2757" y2="411.2757"/><polygon fill="#A80036" points="397,407.2757,387,411.2757,397,415.2757,393,411.2757" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="393" y="392.4667">Pick miner</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="386" x2="433" y1="442.9817" y2="442.9817"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="433" x2="433" y1="442.9817" y2="455.9817"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392" x2="433" y1="455.9817" y2="455.9817"/><polygon fill="#A80036" points="402,451.9817,392,455.9817,402,459.9817,398,455.9817" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="398" y="437.1727">Submit celery task</text><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="131" x="396" y="468.9817"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="400" y="486.8787">celery result timeout</text><rect fill="#FBFB77" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="245" x="324.75" y="529.6877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="358" y="547.5847">Waiting for celery task to start</text><rect fill="#FF9999" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="95" x="524" y="590.3937"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="528" y="608.2907">celery task TTL</text><polygon fill="#A80036" points="680,640.8057,690,644.8057,680,648.8057,684,644.8057" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="519" x2="686" y1="644.8057" y2="644.8057"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="526" y="638.9967">Connect</text><rect fill="#EEEEEE" filter="url(#f11ucvj12t3os4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1752" x="3" y="677.3827"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1755" y1="677.3827" y2="677.3827"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1755" y1="680.3827" y2="680.3827"/><rect fill="#EEEEEE" filter="url(#f11ucvj12t3os4)" height="31.1539" style="stroke: #000000; stroke-width: 2.0;" width="116" x="821" y="662.8057"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="827" y="684.9787">Preparation</text><path d="M195,707.9597 L358,707.9597 L358,716.9597 L348,726.9597 L195,726.9597 L195,707.9597 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="300.1788" style="stroke: #000000; stroke-width: 2.0;" width="702" x="195" y="707.9597"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="210" y="722.8567">Reservation stage</text><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="61" style="stroke: #A80036; stroke-width: 1.0;" width="152" x="529" y="737.6657"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="533" y="755.5627">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="533" y="773.2687">reservation time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="533" y="790.9747">(dynamic config)</text><polygon fill="#A80036" points="680,874.0346,690,878.0346,680,882.0346,684,878.0346" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="686" y1="878.0346" y2="878.0346"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="531" y="819.8506">V0InitialJobRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="531" y="836.8136">-</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="538" y="837.5567">JobStartedReceipt</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="531" y="854.5196">- Executor class</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="531" y="872.2256">- Job timing</text><path d="M707,844.4756 L707,907.4756 L868,907.4756 L868,854.4756 L858,844.4756 L707,844.4756 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M858,844.4756 L858,854.4756 L868,854.4756 L858,844.4756 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="713" y="863.3726">This is essentially a dual</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="713" y="881.0786">reserve+start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="713" y="898.7846">request in one</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="702" x2="744" y1="940.2997" y2="940.2997"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="744" x2="744" y1="940.2997" y2="953.2997"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="703" x2="744" y1="953.2997" y2="953.2997"/><polygon fill="#A80036" points="713,949.2997,703,953.2997,713,957.2997,709,953.2997" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="709" y="934.4907">Reserve executor from pool</text><polygon fill="#A80036" points="535,996.1385,525,1000.1385,535,1004.1385,531,1000.1385" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="691" y1="1000.1385" y2="1000.1385"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="541" y="995.0726">V0AcceptJobRequest</text><polygon fill="#A80036" points="227,996.1385,217,1000.1385,227,1004.1385,223,1000.1385" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="508" y1="1000.1385" y2="1000.1385"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="233" y="977.3666">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="233" y="994.3295">(Accepted)</text><path d="M6,1021.1385 L135,1021.1385 L135,1030.1385 L125,1040.1385 L6,1040.1385 L6,1021.1385 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2925.661" style="stroke: #000000; stroke-width: 2.0;" width="1740" x="6" y="1021.1385"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="21" y="1036.0355">Spinup stage</text><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="96" style="stroke: #A80036; stroke-width: 1.0;" width="149" x="529" y="1056.6975"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="533" y="1074.5945">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="533" y="1092.3005">executor class spinup</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="533" y="1110.0066">(depends on class)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="533" y="1127.7126">+</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="543" y="1127.7126">startup time limit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="533" y="1145.4186">(dynamic config)</text><polygon fill="#A80036" points="1051,1100.9626,1061,1104.9626,1051,1108.9626,1055,1104.9626" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="702" x2="1057" y1="1104.9626" y2="1104.9626"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="709" y="1063.7415">Start executor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="709" y="1081.4475">(via vendor code)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="709" y="1099.1535">(pass executor TTL to deal with zombie executors)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="1105" y1="1181.9336" y2="1181.9336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1105" x2="1105" y1="1181.9336" y2="1194.9336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1064" x2="1105" y1="1194.9336" y2="1194.9336"/><polygon fill="#A80036" points="1074,1190.9336,1064,1194.9336,1074,1198.9336,1070,1194.9336" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="1070" y="1176.1246">...</text><rect fill="#FBFB77" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="618" x="479.25" y="1207.9336"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="705.5" y="1225.8306">Waiting for executor spinup</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="1105" y1="1262.3456" y2="1262.3456"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1105" x2="1105" y1="1262.3456" y2="1275.3456"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1064" x2="1105" y1="1275.3456" y2="1275.3456"/><polygon fill="#A80036" points="1074,1271.3456,1064,1275.3456,1074,1279.3456,1070,1275.3456" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="1070" y="1256.5366">...</text><rect fill="#FBFB77" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="618" x="479.25" y="1288.3456"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="623.5" y="1306.2427">Always-on executors need a couple of seconds here too</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1063" x2="1110" y1="1342.7577" y2="1342.7577"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1110" x2="1110" y1="1342.7577" y2="1355.7577"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1069" x2="1110" y1="1355.7577" y2="1355.7577"/><polygon fill="#A80036" points="1079,1351.7577,1069,1355.7577,1079,1359.7577,1075,1355.7577" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="1075" y="1336.9487">...</text><rect fill="#FF9999" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="85" x="1073" y="1368.7577"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="1077" y="1386.6547">executor TTL</text><path d="M195,1403.4637 L329,1403.4637 L329,1412.4637 L319,1422.4637 L195,1422.4637 L195,1403.4637 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="895.7515" style="stroke: #000000; stroke-width: 2.0;" width="1305" x="195" y="1403.4637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="210" y="1418.3607">Startup stage</text><path d="M498,1432.1697 L561,1432.1697 L561,1441.1697 L551,1451.1697 L498,1451.1697 L498,1432.1697 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="811.2067" style="stroke: #000000; stroke-width: 2.0;" width="977" x="498" y="1432.1697"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="513" y="1447.0667">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="576" y="1445.9286">[Streaming job]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="498" x2="1475" y1="1671.5386" y2="1671.5386"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="503" y="1683.2975">[Buffered job]</text><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="125" x="1078" y="1461.8757"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="1082" y="1479.7727">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="1082" y="1497.4788">startup time limit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="1533.9938" y2="1533.9938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="1533.9938" y2="1546.9938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="1546.9938" y2="1546.9938"/><polygon fill="#A80036" points="1084,1542.9938,1074,1546.9938,1084,1550.9938,1080,1546.9938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="1080" y="1528.1848">Start streaming server, generate server cert and server keypair</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="1578.6998" y2="1578.6998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="1578.6998" y2="1591.6998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="1591.6998" y2="1591.6998"/><polygon fill="#A80036" points="1084,1587.6998,1074,1591.6998,1084,1595.6998,1080,1591.6998" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1080" y="1572.8908">pull docker image</text><polygon fill="#A80036" points="535,1616.8326,525,1620.8326,535,1624.8326,531,1620.8326" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="1057" y1="1620.8326" y2="1620.8326"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="541" y="1615.7667">V0ExecutorReadyRequest</text><polygon fill="#A80036" points="535,1648.5386,525,1652.5386,535,1656.5386,531,1652.5386" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="1057" y1="1652.5386" y2="1652.5386"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="510" x="541" y="1646.7296">"V0StreamingJobReadyRequest" (server_address, port, server_cert, server_public_key)</text><rect fill="#90EE90" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="125" x="1078" y="1692.5205"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="1082" y="1710.4175">Timeout:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="1082" y="1728.1235">startup time limit</text><path d="M850,1745.9325 L850,1808.9325 L1054,1808.9325 L1054,1755.9325 L1044,1745.9325 L850,1745.9325 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1044,1745.9325 L1044,1755.9325 L1054,1755.9325 L1044,1745.9325 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="856" y="1764.8296">Startup time is constant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="856" y="1782.5356">unless we want to allow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="856" y="1800.2416">heavy volume downloads here</text><polygon fill="#A80036" points="897,1837.7566,887,1841.7566,897,1845.7566,893,1841.7566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="891" x2="1057" y1="1841.7566" y2="1841.7566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="903" y="1835.9476">Connect</text><polygon fill="#A80036" points="1051,1866.8894,1061,1870.8894,1051,1874.8894,1055,1870.8894" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="1057" y1="1870.8894" y2="1870.8894"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="893" y="1865.8235">V0InitialJobRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="1902.5954" y2="1902.5954"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="1902.5954" y2="1915.5954"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="1915.5954" y2="1915.5954"/><polygon fill="#A80036" points="1084,1911.5954,1074,1915.5954,1084,1919.5954,1080,1915.5954" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1080" y="1896.7864">CVE check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="1947.3015" y2="1947.3015"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="1947.3015" y2="1960.3015"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="1960.3015" y2="1960.3015"/><polygon fill="#A80036" points="1084,1956.3015,1074,1960.3015,1084,1964.3015,1080,1960.3015" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="1080" y="1941.4924">toolkit ver. check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="1992.0075" y2="1992.0075"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="1992.0075" y2="2005.0075"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="2005.0075" y2="2005.0075"/><polygon fill="#A80036" points="1084,2001.0075,1074,2005.0075,1084,2009.0075,1080,2005.0075" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1080" y="1986.1985">clear old jobs</text><path d="M1047,2017.0075 L1292,2017.0075 L1292,2026.0075 L1282,2036.0075 L1047,2036.0075 L1047,2017.0075 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="188.2361" style="stroke: #000000; stroke-width: 2.0;" width="335" x="1047" y="2017.0075"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="1062" y="2031.9045">docker image in initial details?</text><path d="M1078,2046.7135 L1078,2109.7135 L1357,2109.7135 L1357,2056.7135 L1347,2046.7135 L1078,2046.7135 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1347,2046.7135 L1347,2056.7135 L1357,2056.7135 L1347,2046.7135 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1084" y="2065.6105">this is only for small images, large job</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1084" y="2083.3165">images must be preloaded somewhere else</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1084" y="2101.0225">or this takes too long</text><path d="M1078,2123.8315 L1078,2150.8315 L1342,2150.8315 L1342,2133.8315 L1332,2123.8315 L1078,2123.8315 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1332,2123.8315 L1332,2133.8315 L1342,2133.8315 L1332,2123.8315 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1084" y="2142.7285">if image is preloaded, this will exit quickly</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="2184.2436" y2="2184.2436"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="2184.2436" y2="2197.2436"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="2197.2436" y2="2197.2436"/><polygon fill="#A80036" points="1084,2193.2436,1074,2197.2436,1084,2201.2436,1080,2197.2436" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1080" y="2178.4346">pull docker image</text><polygon fill="#A80036" points="535,2231.3764,525,2235.3764,535,2239.3764,531,2235.3764" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="1057" y1="2235.3764" y2="2235.3764"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="541" y="2230.3105">V0ExecutorReadyRequest</text><polygon fill="#A80036" points="227,2287.2152,217,2291.2152,227,2295.2152,223,2291.2152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="508" y1="2291.2152" y2="2291.2152"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="233" y="2268.4433">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="233" y="2285.4062">(Executor ready)</text><rect fill="#EEEEEE" filter="url(#f11ucvj12t3os4)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1752" x="3" y="2332.7922"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1755" y1="2332.7922" y2="2332.7922"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1755" y1="2335.7922" y2="2335.7922"/><rect fill="#EEEEEE" filter="url(#f11ucvj12t3os4)" height="31.1539" style="stroke: #000000; stroke-width: 2.0;" width="130" x="814" y="2318.2152"/><text fill="#000000" font-family="sans-serif" font-size="17" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="820" y="2340.3882">Job execution</text><path d="M479.25,2364.3692 L479.25,2427.3692 L1097.25,2427.3692 L1097.25,2374.3692 L1087.25,2364.3692 L479.25,2364.3692 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1087.25,2364.3692 L1087.25,2374.3692 L1097.25,2374.3692 L1087.25,2364.3692 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="502" y="2383.2662">It's important for both parties to start the deadline timer right here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="477" x="502" y="2400.9722">In practice, the validator will start its timer a bit later than executor - this is good,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="560" x="502" y="2418.6782">as the validator is then less likely to time out before the executor. (unless the executor is dead)</text><path d="M25,2440.4872 L88,2440.4872 L88,2449.4872 L78,2459.4872 L25,2459.4872 L25,2440.4872 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1360.6346" style="stroke: #000000; stroke-width: 2.0;" width="1696" x="25" y="2440.4872"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="40" y="2455.3842">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="103" y="2454.2461">[Streaming job]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="25" x2="1721" y1="2577.3113" y2="2577.3113"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="30" y="2589.0702">[Buffered job]</text><path d="M44,2469.1932 L117,2469.1932 L117,2478.1932 L107,2488.1932 L44,2488.1932 L44,2469.1932 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.118" style="stroke: #000000; stroke-width: 2.0;" width="1496.5" x="44" y="2469.1932"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="59" y="2484.0902">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="132" y="2482.9521">[until Client terminates the job or timeout occurs]</text><polygon fill="#A80036" points="1447,2513.6053,1457,2517.6053,1447,2521.6053,1451,2517.6053" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="60" x2="1453" y1="2517.6053" y2="2517.6053"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="67" y="2511.7963">Send request. It is signed using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="255" y="2511.7963">client private key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="369" y="2511.7963">.</text><polygon fill="#A80036" points="71,2545.3113,61,2549.3113,71,2553.3113,67,2549.3113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="1453" y1="2549.3113" y2="2549.3113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="77" y="2543.5023">Reply. Response is signed with the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="284" y="2543.5023">Job public key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="373" y="2543.5023">.</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="84" x="1073" y="2598.2932"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1077" y="2616.1902">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1077" y="2633.8962">leeway</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="84" x="529" y="2651.7052"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="533" y="2669.6022">Set deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="533" y="2687.3082">leeway</text><path d="M195,2704.1172 L345,2704.1172 L345,2713.1172 L335,2723.1172 L195,2723.1172 L195,2704.1172 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="386.1782" style="stroke: #000000; stroke-width: 2.0;" width="1501" x="195" y="2704.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="210" y="2719.0142">Download stage</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="140" x="529" y="2733.8232"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="533" y="2751.7203">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="533" y="2769.4263">download time limit</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="140" x="1078" y="2733.8232"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1082" y="2751.7203">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="1082" y="2769.4263">download time limit</text><polygon fill="#A80036" points="1051,2819.6473,1061,2823.6473,1051,2827.6473,1055,2823.6473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="1057" y1="2823.6473" y2="2823.6473"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="531" y="2800.1323">"V0JobRequest"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="531" y="2817.8383">- Job volumes</text><polygon fill="#A80036" points="1442,2851.3533,1452,2855.3533,1442,2859.3533,1446,2855.3533" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1448" y1="2855.3533" y2="2855.3533"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1080" y="2849.5443">"unpack_volume()"</text><path d="M1469,2868.3533 L1469,2913.3533 L1642,2913.3533 L1642,2878.3533 L1632,2868.3533 L1469,2868.3533 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1632,2868.3533 L1632,2878.3533 L1642,2878.3533 L1632,2868.3533 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="1475" y="2887.2503">Implementation depends</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="1475" y="2904.9564">on volume type</text><path d="M1469,2927.7654 L1469,2954.7654 L1671,2954.7654 L1671,2937.7654 L1661,2927.7654 L1469,2927.7654 " fill="#FBFB77" filter="url(#f11ucvj12t3os4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1661,2927.7654 L1661,2937.7654 L1671,2937.7654 L1661,2927.7654 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="1475" y="2946.6624">Multi volume does a loop here</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1464" x2="1506" y1="2988.1774" y2="2988.1774"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1506" x2="1506" y1="2988.1774" y2="3001.1774"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1465" x2="1506" y1="3001.1774" y2="3001.1774"/><polygon fill="#A80036" points="1475,2997.1774,1465,3001.1774,1475,3005.1774,1471,3001.1774" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="1471" y="2982.3684">Download</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="1540" y="2982.3684">+ unpack</text><polygon fill="#A80036" points="1084,3028.8834,1074,3032.8834,1084,3036.8834,1080,3032.8834" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1078" x2="1453" y1="3032.8834" y2="3032.8834"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1090" y="3027.0744">done</text><polygon fill="#A80036" points="535,3078.2954,525,3082.2954,535,3086.2954,531,3082.2954" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="1057" y1="3082.2954" y2="3082.2954"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="541" y="3076.4864">V0VolumesReady</text><polygon fill="#A80036" points="227,3078.2954,217,3082.2954,227,3086.2954,223,3082.2954" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="508" y1="3082.2954" y2="3082.2954"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="233" y="3058.7804">"V0JobStatusUpdate"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="233" y="3076.4864">(Volumes ready)</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="143" x="529" y="3104.2954"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="533" y="3122.1925">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="533" y="3139.8985">execution time limit</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="143" x="1078" y="3104.2954"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1082" y="3122.1925">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="1082" y="3139.8985">execution time limit</text><path d="M195,3156.7075 L345,3156.7075 L345,3165.7075 L335,3175.7075 L195,3175.7075 L195,3156.7075 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.2361" style="stroke: #000000; stroke-width: 2.0;" width="1379" x="195" y="3156.7075"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="210" y="3171.6045">Execution stage</text><polygon fill="#A80036" points="1447,3201.1195,1457,3205.1195,1447,3209.1195,1451,3205.1195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1073" x2="1453" y1="3205.1195" y2="3205.1195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="1080" y="3199.3105">docker run</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1459" x2="1501" y1="3236.8255" y2="3236.8255"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1501" x2="1501" y1="3236.8255" y2="3249.8255"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1460" x2="1501" y1="3249.8255" y2="3249.8255"/><polygon fill="#A80036" points="1470,3245.8255,1460,3249.8255,1470,3253.8255,1466,3249.8255" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1466" y="3231.0165">Actual work</text><polygon fill="#A80036" points="1084,3277.5315,1074,3281.5315,1084,3285.5315,1080,3281.5315" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1078" x2="1458" y1="3281.5315" y2="3281.5315"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="1090" y="3275.7225">stdout, stderr</text><polygon fill="#A80036" points="535,3326.9436,525,3330.9436,535,3334.9436,531,3330.9436" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529" x2="1057" y1="3330.9436" y2="3330.9436"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="541" y="3325.1346">V0ExecutionDone</text><polygon fill="#A80036" points="227,3326.9436,217,3330.9436,227,3334.9436,223,3330.9436" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="508" y1="3330.9436" y2="3330.9436"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="233" y="3307.4286">"V0JobStatusUpdate"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="233" y="3325.1346">(Execution done)</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="121" x="529" y="3352.9436"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="533" y="3370.8406">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="533" y="3388.5466">upload time limit</text><rect fill="#AAAAEE" filter="url(#f11ucvj12t3os4)" height="43" style="stroke: #A80036; stroke-width: 1.0;" width="121" x="1078" y="3352.9436"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1082" y="3370.8406">Extend deadline:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="1082" y="3388.5466">upload time limit</text><path d="M456.5,3405.3556 L586.5,3405.3556 L586.5,3414.3556 L576.5,3424.3556 L456.5,3424.3556 L456.5,3405.3556 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="386.7662" style="stroke: #000000; stroke-width: 2.0;" width="1109" x="456.5" y="3405.3556"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="471.5" y="3420.2526">Upload stage</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="3453.7676" y2="3453.7676"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="3453.7676" y2="3466.7676"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="3466.7676" y2="3466.7676"/><polygon fill="#A80036" points="1084,3462.7676,1074,3466.7676,1084,3470.7676,1080,3466.7676" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1080" y="3447.9586">Serialize artifacts</text><path d="M1047,3478.7676 L1120,3478.7676 L1120,3487.7676 L1110,3497.7676 L1047,3497.7676 L1047,3478.7676 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="101.118" style="stroke: #000000; stroke-width: 2.0;" width="493.5" x="1047" y="3478.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1062" y="3493.6647">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="1135" y="3492.5266">["MultiUploadOutputUploader"]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="3527.1797" y2="3527.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="3527.1797" y2="3540.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="3540.1797" y2="3540.1797"/><polygon fill="#A80036" points="1084,3536.1797,1074,3540.1797,1084,3544.1797,1080,3540.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="1080" y="3521.3707">Zip the volume</text><polygon fill="#A80036" points="1447,3567.8857,1457,3571.8857,1447,3575.8857,1451,3571.8857" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1453" y1="3571.8857" y2="3571.8857"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="1080" y="3566.0767">Start upload</text><polygon fill="#A80036" points="1452,3608.5917,1462,3612.5917,1452,3616.5917,1456,3612.5917" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1458" y1="3612.5917" y2="3612.5917"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1080" y="3606.7827">Upload stdout/stderr</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1073" x2="1115" y1="3644.2977" y2="3644.2977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115" x2="1115" y1="3644.2977" y2="3657.2977"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1115" y1="3657.2977" y2="3657.2977"/><polygon fill="#A80036" points="1084,3653.2977,1074,3657.2977,1084,3661.2977,1080,3657.2977" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1080" y="3638.4887">await upload tasks</text><polygon fill="#A80036" points="1084,3685.0037,1074,3689.0037,1084,3693.0037,1080,3689.0037" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1078" x2="1453" y1="3689.0037" y2="3689.0037"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1090" y="3683.1947">Upload done</text><polygon fill="#A80036" points="1084,3716.7098,1074,3720.7098,1084,3724.7098,1080,3720.7098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1078" x2="1453" y1="3720.7098" y2="3720.7098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1090" y="3714.9008">Upload done</text><polygon fill="#A80036" points="1084,3748.4158,1074,3752.4158,1084,3756.4158,1080,3752.4158" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1078" x2="1453" y1="3752.4158" y2="3752.4158"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1090" y="3746.6068">Upload done</text><polygon fill="#A80036" points="1084,3780.1218,1074,3784.1218,1084,3788.1218,1080,3784.1218" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1078" x2="1458" y1="3784.1218" y2="3784.1218"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1090" y="3778.3128">Upload done</text><polygon fill="#A80036" points="525,3827.2546,515,3831.2546,525,3835.2546,521,3831.2546" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="519" x2="1057" y1="3831.2546" y2="3831.2546"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="531" y="3826.1887">V0JobFinished</text><rect fill="#FBFB77" filter="url(#f11ucvj12t3os4)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="177" x="292.5" y="3844.2546"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="296.5" y="3862.1516">Waiting for celery task result</text><polygon fill="#A80036" points="227,3909.7994,217,3913.7994,227,3917.7994,223,3913.7994" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="375" y1="3913.7994" y2="3913.7994"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="233" y="3891.0275">V0JobStatusUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="233" y="3907.9904">(Complete)</text><!--MD5=[0ce7fc20eda034071f9fd9c24116d632]
@startuml
!pragma teoz true
skinparam sequenceBoxBorderColor #gray
Actor Client
box Facilitator #ffb
participant Facilitator
end box
box Validator #eef5ff
participant "Facilitator connection"
participant "Job driver"
end box
box Miner #lightyellow
participant "Validator Consumer"
participant "Executor Consumer"
end box
box Executor #efefef
participant Executor
participant "Task/Subprocess"
end box

"Facilitator connection" -> Facilitator: Connect
activate Facilitator
|||
...

Client->Client: Generate client keypair
Client-> Facilitator: Create job\n(HTTP)
Facilitator -> "Facilitator connection": ""V2JobRequest""
activate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Received)

"Facilitator connection" -> "Facilitator connection": Pick miner
"Facilitator connection" -> "Facilitator connection": Submit celery task
activate "Facilitator connection" #lightgreen
rnote right of "Facilitator connection" #lightgreen: celery result timeout
|||
rnote over "Facilitator connection", "Job driver": Waiting for celery task to start
|||
activate "Job driver" #f99
rnote right of "Job driver" #f99: celery task TTL
"Job driver" -> "Validator Consumer": Connect
activate "Validator Consumer"


== =Preparation ==

group Reservation stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**reservation time limit**\n(dynamic config)
"Job driver" -> "Validator Consumer": ""V0InitialJobRequest""\n- ""JobStartedReceipt""\n- Executor class\n- Job timing
&note right of "Validator Consumer": This is essentially a dual\nreserve+start executor\nrequest in one
"Validator Consumer" -> "Validator Consumer": Reserve executor from pool
"Validator Consumer" -> "Job driver": ""V0AcceptJobRequest""
&"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Accepted)
deactivate "Job driver"
end group

group Spinup stage
activate "Job driver" #lightgreen
rnote right of "Job driver" #lightgreen: Timeout:\n**executor class spinup**\n(depends on class)\n+ **startup time limit**\n(dynamic config)
&"Validator Consumer" - -> Executor: Start executor\n(via vendor code)\n(pass executor TTL to deal with zombie executors)
Executor -> Executor: ...
rnote over "Job driver", Executor: Waiting for executor spinup
Executor -> Executor: ...
rnote over "Job driver", Executor: Always-on executors need a couple of seconds here too
Executor -> Executor: ...

activate Executor #f99
rnote right of Executor #f99: executor TTL

group Startup stage
alt Streaming job
    activate Executor #lightgreen
    rnote right of "Executor" #lightgreen: Timeout:\n**startup time limit**
    Executor -> Executor: Start streaming server, generate server cert and server keypair
    Executor -> Executor: pull docker image
    Executor -> "Job driver": ""V0ExecutorReadyRequest""
    deactivate Executor
    Executor -> "Job driver": "V0StreamingJobReadyRequest" (server_address, port, server_cert, server_public_key)
else Buffered job
    activate Executor #lightgreen
    rnote right of "Executor" #lightgreen: Timeout:\n**startup time limit**
    note left of "Executor": Startup time is constant\nunless we want to allow\nheavy volume downloads here
    Executor -> "Executor Consumer": Connect
    activate "Executor Consumer"
    "Executor Consumer" -> Executor: ""V0InitialJobRequest""
    Executor -> "Executor": CVE check
    Executor -> "Executor": toolkit ver. check
    Executor -> Executor: clear old jobs
    group docker image in initial details?
    note right of Executor: this is only for small images, large job\nimages must be preloaded somewhere else\nor this takes too long
    note right of Executor: if image is preloaded, this will exit quickly
    Executor -> Executor: pull docker image
    end group
    Executor -> "Job driver": ""V0ExecutorReadyRequest""
    deactivate Executor
end

"Job driver" -> Facilitator: ""V0JobStatusUpdate""\n(Executor ready)
deactivate "Job driver"
end group

== =Job execution ==
note over "Job driver", "Executor": It's important for both parties to start the deadline timer right here.\nIn practice, the validator will start its timer a bit later than executor - this is good,\nas the validator is then less likely to time out before the executor. (unless the executor is dead)

alt Streaming job
    activate "Task/Subprocess"
    loop until Client terminates the job or timeout occurs
    Client->"Task/Subprocess": Send request. It is signed using **client private key**.
    activate "Task/Subprocess" #darkgreen
    Client<-"Task/Subprocess": Reply. Response is signed with the **Job public key**.
    deactivate "Task/Subprocess"
    end
    deactivate "Task/Subprocess"
else Buffered job
    rnote right of Executor #aae: Set deadline:\n**leeway**
    activate "Job driver" #aae
    rnote right of "Job driver" #aae: Set deadline:\n**leeway**
    activate "Executor" #aae
    group Download stage
    rnote right of "Job driver" #aae: Extend deadline:\n**download time limit**
    &rnote right of Executor #aae: Extend deadline:\n**download time limit**

    "Job driver" -> "Executor": "V0JobRequest"\n- Job volumes
    Executor -> "Task/Subprocess": "unpack_volume()"
    activate "Task/Subprocess"
    note right of "Task/Subprocess": Implementation depends\non volume type
    note right of "Task/Subprocess": Multi volume does a loop here
    "Task/Subprocess" -> "Task/Subprocess": **Download** + unpack
    return done
    deactivate "Task/Subprocess"
    "Executor" -> "Job driver": V0VolumesReady
    &"Job driver" -> Facilitator: "V0JobStatusUpdate"\n(Volumes ready)
    end group

    rnote right of "Job driver" #aae: Extend deadline:\n**execution time limit**
    &rnote right of Executor #aae: Extend deadline:\n**execution time limit**
    group Execution stage

    Executor - -> "Task/Subprocess": docker run
    activate "Task/Subprocess"
    "Task/Subprocess" -> "Task/Subprocess": Actual work
    "Task/Subprocess" -> Executor: stdout, stderr
    deactivate "Task/Subprocess"

    "Executor" -> "Job driver": V0ExecutionDone
    &"Job driver" -> Facilitator: "V0JobStatusUpdate"\n(Execution done)
    end group

    rnote right of "Job driver" #aae: Extend deadline:\n**upload time limit**
    &rnote right of Executor #aae: Extend deadline:\n**upload time limit**
    group Upload stage

    Executor -> Executor: Serialize artifacts
    loop "MultiUploadOutputUploader"
    Executor -> Executor: Zip the volume
    Executor -> "Task/Subprocess": Start upload
    activate "Task/Subprocess"
    activate "Task/Subprocess"
    activate "Task/Subprocess"
    end loop
    Executor -> "Task/Subprocess": Upload stdout/stderr
    activate "Task/Subprocess"
    Executor -> Executor: await upload tasks
    "Task/Subprocess" - -> Executor: Upload done
    deactivate "Task/Subprocess"
    "Task/Subprocess" - -> Executor: Upload done
    deactivate "Task/Subprocess"
    "Task/Subprocess" - -> Executor: Upload done
    deactivate "Task/Subprocess"
    "Task/Subprocess" - -> Executor: Upload done
    deactivate "Task/Subprocess"
    deactivate "Job driver"
    deactivate "Executor Consumer"
    deactivate "Validator Consumer"
    deactivate "Job driver"
    

    end group
end

Executor -> "Job driver": ""V0JobFinished""
deactivate Executor
rnote over "Facilitator connection": Waiting for celery task result
deactivate "Facilitator connection"
"Facilitator connection" -> Facilitator: ""V0JobStatusUpdate""\n(Complete)
deactivate Executor

deactivate "Facilitator connection"
|||
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.7+6-Ubuntu-0ubuntu124.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>